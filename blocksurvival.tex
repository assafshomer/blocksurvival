\documentclass[letterpaper,12pt]{report}
\usepackage{fullpage}
\usepackage{amsmath, amsthm, amssymb}
\usepackage{graphicx}
\usepackage{verbatim}
\usepackage{fancyhdr}
\usepackage[colorlinks=true,linkcolor=blue]{hyperref}
\usepackage[all]{xy}
\usepackage{tikz}

\newtheorem{definition}{Definition}[chapter]
\newtheorem{theorem}{Theorem}[chapter]
\theoremstyle{plain}
\newtheorem*{thmHop}{The hopping immunity theorem}
\theoremstyle{definition}
\newtheorem*{example}{Example}

\graphicspath{{Images/}}
 
\renewcommand\topfraction{.9}
\renewcommand\textfraction{.05}
\makeatletter
\begin{comment}
\renewcommand\chapter{\if@openright\cleardoublepage\else\clearpage\fi
                    \thispagestyle{fancy}%
                    \global\@topnum\z@
                    \@afterindentfalse
                    \secdef\@chapter\@schapter}
                    \end{comment}
\makeatother

\title{\textbf{Block withholding mining strategies}}

\author{Assaf Shomer\\
}

\date{\today}

\begin{document}

\maketitle
%\pagestyle{fancy}
\begin{abstract}
We calculate the probability of success of block-withholding mining strategies in bitcoin-like networks.  
These strategies involve building a secret branch of the blockchain and publishing it when longer than the main branch, thus replacing it and ripping the reward associated with the published blocks. We identify two types of block-withholding strategies and chart the parameter space where those are more beneficial than the standard mining strategy suggested in Nakamoto's paper.
Heuristically, those strategies are beneficial only when the miner is "powerful" enough in a precise sense defined below.


\end{abstract}
\pagenumbering{roman}
\tableofcontents
\chapter{Introduction}\label{chap:intro}
\pagenumbering{arabic}
\section{Bitcoin and mining}
Bitcoin is the world's first decentralized digital currency (\cite{Bitcoin}). blah blah
\section{The attack strategy}

\subsection{Honest Miners}
The honest miners following the bitcoin protocol described in \cite{Bitcoin}, publish each block as soon as it is discovered and switch their mining efforts to the head of the blockchain\footnote{In practice different miners may be aware of different branches of the block-tree at a given moment. However, such differences are quickly resolved with very high probability once a new block is found because the protocol names the branch with the maximal difficulty to be the blockchain.} any time a new block is found. 

\begin{equation}\label{theblockchain}\nonumber
\dots\rightarrow\mathit{B}_L\rightarrow\mathit{B}_{L+1}\rightarrow\mathit{B}_{L+2}\rightarrow\dots
\end{equation}

\subsection{Block withholding Miners}
The attackers do not share their newly found blocks and instead work on a $\bf{secret}$ branch of the block-tree until such time that their branch is longer than the main branch. At this time they can publish it and uproot the last $n$ (honestly mined) blocks in favour of their $m>n$ secretly mined ones.

\subsection{Goal}\label{subsec:goal}

Our goal is to calculate the probability that a block-withholding miner of relative power $q$ succeeds in replacing a block (and possibly some number of confirmation blocks on top of it) by publishing a secretly mined branch of the block-tree that is longer than the main branch.
The quantity we are interested in is complimentary to the probability that a given block remains in the block-chain in face of the said block-withholding attack.
Motivated by the work done in \cite{Selfish} we are interested in finding out if and when the block-withholding strategy gives the miner a higher probability of success in mining blocks, compared to the standard strategy outlined in the bitcoin protocol.


\section{Setup}\label{calcsetup}
Let us denote by $\mathcal{H}$ the total hashing power of the network and divide it abstractly into an \emph{Honest} part which holds a portion $p\mathcal{H}$ of the total hashing power (where $p \in [0,1]$) and an \emph{Attacker} which holds the rest $q\mathcal{H}=(1-p)\mathcal{H}$. 

We start our analysis at a given point in time where the blockchain is of length $L$ and denote the last block mined as $\mathit{B}_L$. As time marches on the honest miners continue to mine on top of it ( $\mathit{B}_{L+1}, \mathit{B}_{L+2}, \dots$) while the attackers are building a separate branch on top of $\mathit{B}_L$ ( $\mathit{\tilde{B}}_{L+1}, \mathit{\tilde{B}}_{L+2}, \dots$) with the aim of overtaking it:

\begin{eqnarray}\label{blockwithholdingchain}
 \dots \rightarrow \mathit{B}_L\rightarrow &\mathit{B}_{L+1}\rightarrow\mathit{B}_{L+2}
\rightarrow\dots\rightarrow\mathit{B}_{L+n} \qquad\qquad \mathrm{Main}\\\nonumber
\searrow & \\\nonumber
\qquad \qquad \qquad & \widetilde{\mathit{B}}_{L+1}\rightarrow\widetilde{\mathit{B}}_{L+2}
\longrightarrow \quad \dots \longrightarrow\widetilde{\mathit{B}}_{L+m}\qquad \mathrm{Secret}
\end{eqnarray}

Treating block mining as a negative binomial random variable, the probability $\mathit{P_{n,p}(m)}$ that $m$ blocks are mined by the attackers {\bf before} $n$ blocks were honestly mined is proportional to $p^nq^m$ and can be shown
(appendix \ref{app:probmath}) to be given by

\begin{equation}\label{eq:pnm}
\mathit{P}_{n,q}(m)={n + m -1\choose m}(1-q)^nq^m \quad n=1,2,\dots
\end{equation}

The probability $\mathit{a}_{n,m}(q)$ that the attackers manage to catch-up and overtake the blockchain given the situation above\footnote{Namely, that from the beginning of the experiment until the moment the honest network mines it's $n$th block on top of $\mathit{B}_L$, the attackers managed to mine $m$ blocks on top of $\mathit{B}_L$ constituting their secret branch.} is given by a Markov chain that depends only on the advantage $z$ of the honest network over the attackers $z=n-m$ defined by the recurrence relation

\begin{equation}\label{eq:markov}
\mathit{a}_z(q)=(1-q)\mathit{a}_{z+1}(q)+q\mathit{a}_{z-1}(q)
\end{equation}

The relation can be solved with boundary conditions\footnote{Note that the condition $\mathit{a}_{-1}=&1$ encodes the fact that the attack is successful once the secret chain is \b{longer} than the main chain.} $\mathit{a}_{-1}=&1, \mathit{a}_{\infty}=&0$ by

\begin{equation}\label{eq:az}
\mathit{a}_z(q)=\begin{cases}\left( \dfrac{q}{1-q}\right)^{z+1} & q\in [0,\dfrac{1}{2}] \quad \mathrm{and} \quad z=0,1,2\dots \\ \quad 1 & \mathrm{otherwise} \end{cases}
\end{equation}

For example, to find the probability of a {\bf double-spend attack} on a transaction included in a block $\mathit{B}}_L$ with $n$ confirmations, the attacker needs to catchup from a deficit of $n-(m+1)$. The extra block $m+\mathbf{1}$ is the block where the amount spent in $\mathit{B}_{L}$ was spent again (or resent to the attacker) thus constituting a double-spend attack. This block is denoted with an asterisk $\mathit{B}}_{L}^{*}$ in \ref{dsfigure}:

\begin{eqnarray}\label{dsfigure}
 \dots \rightarrow \mathit{B}_{L-1}\rightarrow &\overbrace{\mathit{B}_{L}\rightarrow\mathit{B}_{L+1}
\rightarrow\dots\rightarrow\mathit{B}_{L+n-1}}^{n \; \mathrm{confirmations}} \qquad\qquad\qquad\qquad\qquad \mathrm{Main}\\\nonumber
\searrow & \\\nonumber
\qquad \qquad \qquad & \underbrace{\widetilde{\mathit{B}}_{L}^{*}\rightarrow\widetilde{\mathit{B}}_{L+1}
\longrightarrow \quad \dots \longrightarrow\widetilde{\mathit{B}}_{L+m}}_{(m+1)\; \mathrm{ blocks}}\qquad\qquad\qquad\qquad \mathrm{Secret}
\end{eqnarray}

This attack was first analyzed in \cite{Bitcoin} \footnote{Approximated by a Poisson process.}, treated more accurately in \cite{Doublespend} and was shown to be 
\begin{equation}\label{eqn:ds}
D_n(p)=\sum_{m=0}^{\infty}P_{n,p}(m)\mathit{a}_{n-(m+1)}(p)
\end{equation}

\section{Block withholding attack - Type 1}

\subsection{Probability of success}\label{probabilityofsuccess}

As explained in \ref{subsec:goal}, our focus here is a little different. 
Let $\mathit{Q}(q)$  be the probability that the attackers succeed in mining a secret branch on top of $\mathit{B}_L$ that is longer than the main branch, which allows them to publish it and replace $\mathit{B}_{L+1}$, and all the blocks honestly mined on top of it. 

Alternatively, $1-\mathit{Q}(q)$ is the probability that $\mathit{B}_{L+1}$ remains in the block-chain despite an attempt of a block-withholding attacker building a secret branch on top of $\mathit{B}_L$.

A successful block-withholding attack on $\mathit{B}_L$ occurs if the attackers manage to catch-up on $B_{L+1}$ after starting with $m=0,1,\dots$ blocks. The starting point for the catch-up process for some $m$ is shown below:

\begin{eqnarray}\label{blockwithholdingboundary}
 \dots \rightarrow \mathit{B}_L\rightarrow &\mathit{B}_{L+1} \qquad\qquad\qquad\qquad\qquad\qquad\qquad\quad \mathrm{Main}\\\nonumber
\searrow & \\\nonumber
\qquad \qquad \qquad & \widetilde{\mathit{B}}_{L+1}\rightarrow\widetilde{\mathit{B}}_{L+2}
\longrightarrow \quad \dots \longrightarrow\widetilde{\mathit{B}}_{L+m}\qquad \mathrm{Secret}
\end{eqnarray}

There are two differences from a double-spend attack described above. One is that we are not requiring a particular number of blocks mined on top of $\mathit{B}_L$ before the secret branch is published. Secondly, we don't require the attacker started the catch-up (with probability of success captured in equation \ref{eq:az}) after mining at least one block. 


\begin{comment}
-------------------------------------
For example, the $m=0$ catch-up starting point in the case of double-spend with a single confirmation is:

\begin{eqnarray}\label{miszerodoublespendboundary}
 \dots \rightarrow \mathit{B}_L\rightarrow &\mathit{B}_{L+1} \qquad\qquad\qquad\qquad\qquad\qquad\qquad\quad \mathrm{Main}\\\nonumber
\searrow & \\\nonumber
\qquad \qquad \qquad & \widetilde{\mathit{B}}_{L+1}^*\qquad\qquad\qquad\qquad\qquad\qquad\qquad\quad \mathrm{Secret}
\end{eqnarray}

while in the block-withholding attack it is:

\begin{eqnarray}\label{miszeroblockwithholdingboundary}
 \dots \rightarrow \mathit{B}_L\rightarrow &\mathit{B}_{L+1} \qquad\qquad\qquad\qquad\qquad\qquad\qquad\quad \mathrm{Main}\\\nonumber
\searrow & \\\nonumber
&\mathit{no\; blocks} \qquad\qquad\qquad\qquad\qquad\qquad\qquad \mathrm{Secret}
\end{eqnarray}
--------------------------------
\end{comment}

Apart from that, the math is very similar. Formally 

\begin{equation}\label{eq:qofpdef}
\mathit{Q}(q)=\sum_{m=0}^{\infty}\mathit{P}_{1,q}(m)\mathit{a}_{1-m}(q)
\end{equation}

which results to (see details in appendix \ref{app:calcqofp})

\begin{equation}\label{eq:qofp}
\mathit{Q}(q)=
\begin{cases}
\dfrac{q^2}{1-q}\left(
3-2q
\right) & \quad q \in [0,\frac{1}{2}] \\
1 & \quad q \in [\frac{1}{2},1] 
\end{cases}
\end{equation}

In Figure ~\ref{fig:PlotProbOfSuccess} we plot the probability of a successful attack as a function of the relative hashing power $q$ against the probability of the attacker being honest, in which case his probability of success is just $q$

\begin{figure}[pos]
\centering
\includegraphics[width=150mm]{Blockwithholdingattack.png}
\caption{The orange curve plots the probability that the attackers manage to uproot the next honest block and replace it with one of their own. The blue curve is the baseline probability for an honest miner with the same hashing power $q$}
\label{fig:PlotProbOfSuccess}
\end{figure}

We see that an attacker improves his chances in the range $q>q_0$ where
\begin{equation}\label{eqn:qnot}
q_0=1-\frac{1}{\sqrt{2}} \sim 0.293
\end{equation}



\newpage

\subsection{Attacker's reward}
Next we calculate the expected reward of a block-withholding attacker.
We assume for simplicity that the reward of each party is simply proportional to the number of blocks mined by that party.

Formally

\begin{equation}\label{eq:rofpdef}
\mathit{R}(p)=\sum_{m=0}^{\infty}m\cdot\mathit{P}_{1,p}(m)\mathit{a}_{1-m}(p)
\end{equation}

which results to (see details in appendix \ref{app:calcrofp})

\begin{equation}\label{eq:rofp}
\mathit{R}(p)=
\begin{cases}
\dfrac{q^2}{1-q}\left(
3-2q
\right) & \quad q \in [0,\frac{1}{2}] \\
\dfrac{q}{1-q} & \quad q \in [\frac{1}{2},1] 
\end{cases}
\end{equation}


In Figure ~\ref{fig:AttackersReward} we plot the attackers reward as a function of the relative hashing power $q$ against the probability of the reward for an honest miner with the same hashing power, which is just $q$.

\begin{figure}[reward]
\centering
\includegraphics[width=150mm]{AttackersReward.png}
\caption{The orange curve plots the attacker's reward. The blue curve is the baseline reward for an honest miner with the same hashing power $q$.}
\label{fig:AttackersReward}
\end{figure}

We note a few things.
\begin{itemize}
\item In the range $q\in[0,\dfrac{1}{2}]$ $R(p)$ is identical to $Q(p)$.
  \item As expected the reward of the attackers exceeds the honest reward at the same point where the probability of success exceeds the honest benchmark. i.e. when $q>1-\frac{1}{\sqrt{2}} \sim 0.293$
  \item As $q\rightarrow 1$ the reward of the attackers diverge, because they basically control the blockchain and can plant as many blocks as they desire.
  \item This may be a little hard to see in Figure ~\ref{fig:AttackersReward} but The function $R(p)$ is continuous but not continuously differentiable. At the point $q=\frac{1}{2}$ the derivative jumps from $4$ to $5$.
\end{itemize}

\section{Block withholding attack - Type 0}
In fact, the attackers have another interesting option. Instead of publishing the secret branch when it is longer than the main branch, they can choose to publish it one step before when the length of the secret branch is the same as the length of the main branch, i.e. when they reach a tie. The reason this is potentially beneficial is that due to latency effects in the bitcoin network (recently discussed in \cite{zoharetal}) not all miners share the same view of the entire block-tree at all moments. All honest miners shift their efforts to the longest branch they know of, but for some short period of time different parts of the network may be aware of different, and equally valid, longest branches. In such a case, each sub-network continues mining it's branch until the next block is mined by either one of them and a new block-chain is established\footnote{In principle this type of block-chain bifurcation can continue to span multiple blocks, with exponentially decreasing probability.}. 

Assume that a fraction $\gamma \in [0,1]$ of the honest miners accept the attackers branch and start mining on top of it. This means that $q+\gamma p$ of the total hashing power is now dedicated to making the attackers branch the longest. With some probability the attacker's branch ends up as the winner. Let us denote the probability that this type of tie strategy succeeds by $S_{\gamma}(q)$.
We can calculate $S_{\gamma}(q)$ starting the same way as we did when we derived \ref{eq:qofp} but use a Markov chain with boundary condition reflecting a tie instead of wining, and multiply that by the probability of an attacker with hashing power $q+\gamma p$ wining the race starting from that point.

Formally, we want to solve \ref{eq:markov} with boundary conditions $b_0=1, b_\infty=0$ which is solved by:

\begin{equation}\label{eq:bz}
\mathit{b}_z(q)=\begin{cases}\left( \dfrac{q}{1-q}\right)^z & q\in [0,\frac{1}{2}] \quad \mathrm{and} \quad z=0,1,2\dots \\ \quad 1 & \mathrm{otherwise} \end{cases}
\end{equation}

Using the same logic used to derive \ref{eq:qofpdef} we get the probability for a tie

\begin{equation}\label{eq:qofpdef}
\mathit{T}(q)= \sum_{m=0}^{\infty}\mathit{P}_{1,q}(m)\mathit{b}_{1-m}(q)
\end{equation}

resulting in (see details in appendix \ref{app:calctofp})

\begin{equation}\label{eq:qofp}
\mathit{T}(q)=
\begin{cases}
2q & \quad q \in [0,\frac{1}{2}] \\
1 & \quad q \in [\frac{1}{2},1] 
\end{cases}
\end{equation}

Now the attacker, joined by $\gamma$ of the honest miners are competing with the rest of the honest miners. The probability to win starting from a tie is thus given by \ref{eq:az}

\begin{equation}\label{eq:azeroeff}
\mathit{a}_0(q_{eff})=\begin{cases} \dfrac{q_{eff}}{1-q_{eff}} & q_{eff}\in [0,\frac{1}{2}] \\  
\quad 1 & q_{eff}\in [\frac{1}{2},1] \\ \end{cases}
\end{equation}

where 
\begin{equation}\label{qeff}
q_{eff}=q+\gamma p=q+\gamma(1-q)
\end{equation}

\begin{figure}[qcrit]
\centering
\includegraphics[width=100mm]{qcritical.png}
\caption{The value of $q_c$ as a function of $\gamma$.}
\label{fig:qcritical}
\end{figure}

The condition $q_{eff}\in [0,\frac{1}{2}]$ translates to $0\leq q\leq q_{c}(\gamma)$ where

\begin{equation}\label{qcrit}
q_{c}(\gamma)=\dfrac{1-2\gamma}{2-2\gamma}
\end{equation}

$q_c$ (depicted in figure \ref{fig:qcritical}) satisfies $0 \leq   q_{c}(\gamma) \leq\dfrac{1}{2}$, monotonically decreases with $\gamma$ and hits $0$ when\footnote{$q_{eff}(\frac{1}{2})=\frac{1}{2}(1+q)$ which is bigger than $\frac{1}{2}$ for any $q$.} $\gamma=\frac{1}{2}$.



Based on all that, the solution to $S_\gamma(q)=T(q)\cdot a_0(q_{eff})$ breaks into three regimes:

\begin{equation}\label{sofq}
S_\gamma(q)=\underbrace{T(q)}_{reach\; a\; tie}\cdot \underbrace{a_0(q_{eff})}_{win\;given\;a\;tie}=
\begin{cases}
2q\cdot\frac{q_{eff}}{1-q_{eff}}=2q\cdot\frac{q(1-\gamma)+\gamma}{(1-q)(1-\gamma)} & q\in [0,\frac{1-2\gamma}{2-2\gamma}] \\ 
2q & q\in [\frac{1-2\gamma}{2-2\gamma},\frac{1}{2}] \\ 
1 & q\in [\frac{1}{2},1] \\ 
\end{cases}
\end{equation}

Note that if $\gamma\geq\frac{1}{2}$ the first regime does not exist and the solution degenerates to:

\begin{equation}\label{sofq2}
S_{\gamma\geq\frac{1}{2}}(q)=T(q)\cdot a_0(q_{eff})=
\begin{cases}
2q & q\in [0,\frac{1}{2}] \\ 
1 & q\in [\frac{1}{2},1] \\ 
\end{cases} \quad = min(2q,1)
\end{equation}

In figure \ref{fig:type0pos} we plot the probability of a successful type 0 attack for various values of the parameter $\gamma$, against the benchmark honest probability of success and the type 1 attack probability of success.


\begin{figure}[blockwithholdingtype2]
\centering
\includegraphics[width=200mm]{type0pos.pdf}
\caption{The probability of success of a type II block withholding attack as a function of $\gamma$. The blue curve plots the honest probability of success, and the orange curve plots the type I attack.}
\label{fig:type0pos}
\end{figure}

\subsection{When is a Type 0 attack beneficial}

To decide if a block-withholding attack of type 0 is beneficial or not we should compare it to the honest probability of success and to a type 1 attack. 

\subsubsection{Comparing type 0 to Honest}
First note that in the second and third regimes in equation \ref{sofq} (or for any $q$ if $\gamma\geq\frac{1}{2}$) the type 0 attacks is beneficial over the honest strategy for any $q$, because for any $q$ it holds that $0\leq q \leq min(2q,1)$. 

In the first regime (i.e. when $q<q_c(\gamma)$) we can find at what value of $q$ the type 0 attacks starts being beneficial over the honest strategy by solving
\begin{equation}\label{type0benefitonhonestequation}
2q\cdot\frac{q(1-\gamma)+\gamma}{(1-q)(1-\gamma)}\geq q
\end{equation}

which gives the condition $q_b(\gamma)\leq q \leq q_c(\gamma)$, where 

\begin{equation}\label{eqn:qb}
q_b= \dfrac{1-3\gamma}{3-3\gamma}
\end{equation}

The value of $q_b$ where the attack starts becoming beneficial compared to the honest strategy is plotted in Figure \ref{fig:qbenefit} and behaves similarly to $q_c$ as given in equation \ref{qcrit} except now the scale is $1/3$.

\begin{figure}[qcrit]
\centering
\includegraphics[width=100mm]{qcqb.png}
\caption{The value of $q_c$ and $q_b$ as a function of $\gamma$.}
\label{fig:qbenefit}
\end{figure}

Note that if $\gamma=0$ this type of attack is beneficial only when $q>\frac{1}{3}$ and if $\gamma\geq\frac{1}{3}$ this attack is beneficial for all $q$.

Taking all three regimes into account we conclude that the type 0 attack is beneficial over the honest strategy when

\begin{equation}\label{0overhonest}
S_{\gamma}(q)\geq q \Longrightarrow
\begin{cases}
q>\dfrac{1-3\gamma}{3-3\gamma} & \gamma\in [0,\frac{1}{3}] \\ 
\mathit{any\;} q & \gamma\in [\frac{1}{3},1] \\ 
\end{cases}
\end{equation}

Next we compare this attack to a type 1 attack.

\subsubsection{Comparing Type 0 to Type 1}

There are two interesting comparisons one can make between Type 0 and Type 1 attacks.

One is to compare how they match against the honest strategy. Namely, for a given $\gamma$ do we first hit the regime where a type 0 or a type 1 is beneficial over the honest strategy.

This type 0 strategy wins earlier (in fact already at $q=0$) when $\gamma\geq\frac{1}{3}$. When $\gamma < \frac{1}{3}$ we can compare $q_b(\gamma)$ (given in equation \ref{eqn:qb}) with $q_0$ (given in equation \ref{eqn:qnot}):

\begin{equation}\label{qbornot}
\dfrac{1-3\gamma}{3-3\gamma}<1-\dfrac{1}{\sqrt{2}}
\end{equation}

which gives $\gamma>\gamma_c$ where 

\begin{equation}\label{gamma0before1}
\gamma_c=1-\frac{2}{3}\sqrt{2}\sim 0.0572
\end{equation}

Indeed, you can see in Figure \ref{fig:type0pos} that the green curve representing $\gamma=0$ lies below the orange curve which represents the Type 1 strategy, while the red curve representing $\gamma=0.1>\gamma_c$ lies above it.

To summarize, when $\gamma\geq\frac{1}{3}$ the Type 0 strategy is beneficial over the honest strategy for any value of $q$. When $\gamma<\frac{1}{3}$ , the hashing power of the attacker needs to exceed a threshold before a block withholding strategy is beneficial. If $\gamma_c\leq\gamma\leq\frac{1}{3}$ we bump into the Type 0 first (the threshold given by $q_b=\frac{1-3\gamma}{3-3\gamma}$), while if $\gamma<\gamma_c$ we bump into Type 1 first (the threshold is given by $q_0=1-\frac{1}{\sqrt{2}}$).

Finally, ignoring the honest strategy for a moment, we can ask for the range of parameters $q,\gamma$ where the Type 0 strategy is more beneficial than the Type 1 strategy. Formally we need to solve:

\begin{equation}\label{eqn:type0overtype1}
2q\cdot\frac{q(1-\gamma)+\gamma}{(1-q)(1-\gamma)}\geq \dfrac{q^2}{1-q}\left(
3-2q
\right)`
\end{equation}

which gives the condition

\begin{equation}\label{eqn:type0over1condition}
2q^2-q+\frac{2\gamma}{1-\gamma}\geq 0
\end{equation}

This condition is satisfied in two regimes for $\gamma$.
\begin{equation}\label{eqn:type0over1gammaregimes}
S_{\gamma}(q)\geq Q(q) \Longrightarrow
\begin{cases}
\mathit{any\;} q & \gamma\in [\frac{1}{17},1] \\ 
q<\frac{1}{4}\left(1-\sqrt{\frac{1-17\gamma}{1-\gamma}}\right)\quad \mathit{or}\quad q>\frac{1}{4}\left(1+\sqrt{\frac{1-17\gamma}{1-\gamma}}\right) & \gamma\in [0,\frac{1}{17}] \\ 
\end{cases}
\end{equation}


\subsection{The $\gamma,q$ phase space}\label{gqphase}

\newpage



\appendix
\chapter{Calculation Details}
\section{Probability distribution} \label{app:probmath}

To find the normalization in the case $n>0$ we use the useful binomial identity holding for any complex $s$ inside the unit circle ($|s|<1$)

\dfrac{1}{(1-s)^n}=\sum_{k=0}^{\infty} {n + k -1\choose k}s^k.

It is now straightforward to show that \ref{eq:pnm} is indeed a probability distribution

\sum_{m=0}^{\infty}\mathit{P}(n,m,p)=p^n\sum_{m=0}^{\infty}{n + m -1\choose m}q^m=p^n\dfrac{1}{(1-q)^n}=1

\section{Calculating $\mathit{Q}(q)$ } \label{app:calcqofp} 

$\mathit{Q}(q)$  can be solved in the two regions for the parameter $q$ given in \ref{eq:az}.

In the case  that $q\in [0,\dfrac{1}{2}]$

\begin{eqnarray}\label{eq:rpcalc}\nonumber
&\mathit{Q}(q)=\sum_{m=0}^{\infty}\mathit{P}_{1,q}(m)\mathit{a}_{1-m}(q)=p\sum_{m=0}^{\infty}q^m\mathit{a}_{1-m}(p)=p\left(
\mathit{a}_1(p)+q\mathit{a}_0(p)+\sum_{m=2}^{\infty}q^m
 \right)=\\\nonumber
 &p\left(
\left(\dfrac{q}{p}\right)^2+q\dfrac{q}{p}+\left(\sum_{m=0}^{\infty}q^m\right)-1-q
 \right) 
 =p\left(
\left(\dfrac{q}{p}\right)^2+\dfrac{q^2p}{p^2}+\dfrac{1}{p}-(1+q)
 \right)=\\\nonumber
&\dfrac{1}{p}\left(
q^2(1+p)+p-p^2(1+q)
\right) 
 =\dfrac{1}{p}
\left(q^2(1+p)+p-p^2(1+q)
 \right)=\\\nonumber
&\dfrac{1}{1-q}\left(
q^2(2-q)+1-q-(1-q)^2(1+q)
\right) 
 =\\\nonumber
 &\dfrac{1}{1-q}\left(
2q^2-q^3+1-q-1+2q-q^2 -q+2q^2-q^3
\right) = \dfrac{q^2}{1-q}\left(
3-2q
\right)
\end{eqnarray}

In the case  that $q\notin [0,\dfrac{1}{2}]$

\begin{eqnarray}\nonumber
&\mathit{Q}(q)=p\sum_{m=0}^{\infty}q^m\mathit{a}_{1-m}(p)=p\left(
\mathit{a}_1(p)+q\mathit{a}_0(p)+\sum_{m=2}^{\infty}q^m
 \right)=\\\nonumber
 &p
\left(1+q+\left(\sum_{m=0}^{\infty}q^m\right)-1-q
 \right) 
 =p\dfrac{1}{p}=1
\end{eqnarray}

\section{Calculating $\mathit{T}(q)$ } \label{app:calctofp} 

$\mathit{T}(q)$  can be solved in the two regions for the parameter $q$ given in \ref{eq:az}.

In the case  that $q\in [0,\dfrac{1}{2}]$

\begin{eqnarray}\label{eq:rpcalc}\nonumber
&\mathit{Q}(q)=\sum_{m=0}^{\infty}\mathit{P}_{1,q}(m)\mathit{b}_{1-m}(q)=p\sum_{m=0}^{\infty}q^m\mathit{b}_{1-m}(p)=p\left(
\mathit{b}_1(q)+\sum_{m=1}^{\infty}q^m
 \right)=\\\nonumber
 &p\left(
\dfrac{q}{p}+\left(\sum_{m=0}^{\infty}q^m\right)-1
 \right) 
 =p\left(
\dfrac{q}{p}+\dfrac{1}{1-q}-1
 \right)=q+1-p=2q\\\nonumber
\end{eqnarray}

and the case $q\notin [0,\dfrac{1}{2}]$ is identical to $\mathit{Q}(q)$

\section{Calculating $\mathit{R}(p)$ } \label{app:calcrofp}  

$\mathit{R}(p)$  can be solved in the two regions for the parameter $q$ given in \ref{eq:az}.

In the case  that $q\in [0,\dfrac{1}{2}]$

\begin{eqnarray}\label{eq:rpcalc}\nonumber
&\mathit{R}(p)=p\sum_{m=0}^{\infty}m\cdot q^m\mathit{a}_{1-m}(p)=p\left(
q\mathit{a}_0(p)+\sum_{m=2}^{\infty}m\cdot q^m
 \right)=\\\nonumber
 &p\left(
q\dfrac{q}{p}+\left(\sum_{m=0}^{\infty}m\cdot q^m\right)-q
 \right) 
 =p\left(
\dfrac{q^2}{p}+q\partial_q\left(\sum_{m=0}^{\infty} q^m\right)-q
 \right)=\\\nonumber
& q^2+pq\partial_q\left(\dfrac{1}{1-q}\right)-pq 
 = q^2+pq\left(\dfrac{1}{p^2} -1\right) =q^2+q\dfrac{(1+p)(1-p)}{p}=
 \\\nonumber
& q^2\left(1+\dfrac{2-q}{1-q}\right)= \dfrac{q^2}{1-q}\left(
3-2q\right)=\mathit{Q}(p)
\end{eqnarray}


In the case  that $q\notin [0,\dfrac{1}{2}]$

\begin{eqnarray}\nonumber
&\mathit{R}(p)=p\sum_{m=0}^{\infty}m\cdot q^m\mathit{a}_{1-m}(p)=p\left(
q\mathit{a}_0(p)+\sum_{m=2}^{\infty}m\cdot q^m
 \right)=\\\nonumber
 & p\left(q+\left(\sum_{m=0}^{\infty}m\cdot q^m\right)-q \right) =pq\partial_q\left(\dfrac{1}{1-q}\right)=\dfrac{q}{1-q}
\end{eqnarray}


\newpage
\bibliographystyle{plain} % IEEEtr, plain, abbrv, alpha
\addcontentsline{toc}{chapter}{Bibliography}
\bibliography{blocksurvival}
\end{document} %\input{bibliography}
